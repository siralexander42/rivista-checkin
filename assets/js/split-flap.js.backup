/**
 * SPLIT-FLAP EFFECT - Airport Board Anni '70
 * Gestisce l'effetto flip quando le sezioni entrano in vista
 */

(function() {
    'use strict';

    class SplitFlapEffect {
        constructor() {
            this.sections = document.querySelectorAll('section');
            this.init();
        }

        init() {
            console.log('✈️ Split-Flap Effect initialized');

            // Setup Intersection Observer
            this.setupObserver();
        }

        setupObserver() {
            const observerOptions = {
                root: null,
                rootMargin: '100px 0px', // Trigger 100px PRIMA
                threshold: 0 // Appena 1px entra!
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const section = entry.target;
                    const sectionId = section.id || section.className;

                    // Skip hero e cremona
                    if (section.classList.contains('hero-simple') || 
                        section.classList.contains('cremona-scroll-section')) {
                        return;
                    }

                    if (entry.isIntersecting) {
                        // Trigger flip SUBITO quando entra
                        if (!section.classList.contains('flipped')) {
                            console.log('✈️ FLIP START:', sectionId);
                            section.classList.add('flipped');
                        }
                    } else {
                        // Reset quando esce
                        if (section.classList.contains('flipped')) {
                            console.log('📕 FLIP RESET:', sectionId);
                            section.classList.remove('flipped');
                        }
                    }
                });
            }, observerOptions);

            // Osserva tutte le sezioni (tranne hero e cremona)
            let observedCount = 0;
            this.sections.forEach(section => {
                const sectionId = section.id || section.className;
                if (!section.classList.contains('hero-simple') && 
                    !section.classList.contains('cremona-scroll-section')) {
                    observer.observe(section);
                    observedCount++;
                    console.log('�️ WATCHING:', sectionId);
                }
            });
            
            console.log('✅ OBSERVER READY -', observedCount, 'sections');
        }
    }

    // Inizializza dopo DOM ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            new SplitFlapEffect();
        });
    } else {
        new SplitFlapEffect();
    }

})();
