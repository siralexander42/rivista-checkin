<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modalit√† Sviluppatore - CHECK-IN CMS</title>
    <link rel="icon" type="image/png" href="https://www.italiaatavola.net/images/contenutiarticoli/logo_check-in-favicon.png">
    <link rel="stylesheet" href="css/admin.css?v=8.0">
    <link rel="stylesheet" href="css/image-cropper.css?v=1.0">
    <style>
        .dev-mode-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            display: inline-block;
            margin-left: 12px;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }
        
        .code-editor {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre;
            border: 1px solid rgba(60, 61, 143, 0.2);
        }
        
        .json-viewer {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .block-preview-card {
            background: white;
            border: 1.5px solid rgba(60, 61, 143, 0.12);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }
        
        .block-preview-card:hover {
            box-shadow: 0 4px 12px rgba(60, 61, 143, 0.15);
            transform: translateY(-2px);
        }
        
        .block-type-label {
            display: inline-block;
            padding: 4px 10px;
            background: linear-gradient(135deg, rgba(211, 228, 252, 0.5) 0%, rgba(232, 241, 253, 0.5) 100%);
            border: 1px solid rgba(60, 61, 143, 0.15);
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .magazine-selector {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1.5px solid rgba(60, 61, 143, 0.12);
        }
        
        .blocks-template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .block-template-card {
            background: var(--bg-white);
            border: 1.5px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 20px;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }
        
        .block-template-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .block-template-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .block-template-icon {
            font-size: 32px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-light) 0%, rgba(99, 102, 241, 0.1) 100%);
            border-radius: 12px;
        }
        
        .block-template-info h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-dark);
        }
        
        .block-template-info p {
            margin: 4px 0 0 0;
            font-size: 12px;
            color: var(--text-light);
        }
        
        .block-template-fields {
            margin-bottom: 16px;
        }
        
        .block-template-fields-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .block-template-field-tag {
            display: inline-block;
            padding: 4px 10px;
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            font-size: 11px;
            color: var(--text-dark);
            margin: 4px 4px 4px 0;
        }
        
        .block-template-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-block-action {
            flex: 1;
            padding: 8px 12px;
            border: 1.5px solid var(--border-light);
            background: var(--bg-white);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-dark);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .btn-block-action:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-1px);
        }
        
        .btn-block-action.secondary:hover {
            background: var(--bg-light);
            border-color: var(--border);
            color: var(--text-dark);
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="https://www.italiaatavola.net/images/testate/checkin-testata-hd.svg" alt="CHECK-IN" style="width: 100%; max-width: 180px; filter: brightness(0) invert(1);">
                <p id="welcomeMessage" style="color: rgba(255, 255, 255, 0.9); font-size: 12px; margin-top: 12px; font-weight: 500; letter-spacing: 0.5px; min-height: 18px;"></p>
            </div>
            
            <nav class="sidebar-nav">
                <a href="index.html" class="nav-item">
                    <span>Dashboard</span>
                </a>
                <a href="magazines.html" class="nav-item">
                    <span>Riviste</span>
                </a>
                <a href="#" class="nav-item" id="usersNavItem">
                    <span>Utenti</span>
                </a>
                <a href="permissions.html" class="nav-item" id="permissionsNavItem" style="display: none;">
                    <span>Permessi</span>
                </a>
                <a href="logs.html" class="nav-item">
                    <span>Log Accessi</span>
                </a>
                <a href="developer.html" class="nav-item active">
                    <span>Modalit√† Sviluppatore</span>
                </a>
                <a href="#" class="nav-item" id="advNavItem">
                    <span>ADV</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <button onclick="logout()" class="btn btn-danger btn-full">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 50 50"><path d="M 25 2 C 12.308594 2 2 12.308594 2 25 C 2 37.691406 12.308594 48 25 48 C 37.691406 48 48 37.691406 48 25 C 48 12.308594 37.691406 2 25 2 Z M 25 4 C 36.609375 4 46 13.390625 46 25 C 46 36.609375 36.609375 46 25 46 C 13.390625 46 4 36.609375 4 25 C 4 13.390625 13.390625 4 25 4 Z M 32.990234 15.986328 A 1.0001 1.0001 0 0 0 32.292969 16.292969 L 25 23.585938 L 17.707031 16.292969 A 1.0001 1.0001 0 0 0 16.990234 15.990234 A 1.0001 1.0001 0 0 0 16.292969 17.707031 L 23.585938 25 L 16.292969 32.292969 A 1.0001 1.0001 0 1 0 17.707031 33.707031 L 25 26.414063 L 32.292969 33.707031 A 1.0001 1.0001 0 1 0 33.707031 32.292969 L 26.414063 25 L 33.707031 17.707031 A 1.0001 1.0001 0 0 0 32.990234 15.986328 Z"/></svg>
                    Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1>‚öôÔ∏è Modalit√† Sviluppatore <span class="dev-mode-badge">DEV MODE</span></h1>
                    <p>Gestisci blocchi avanzati e configurazioni del sistema</p>
                </div>
            </div>

            <!-- Magazine Selector -->
            <div class="magazine-selector">
                <label style="font-weight: 600; margin-bottom: 12px; display: block;">üìö Seleziona Rivista</label>
                <select id="magazineSelect" class="form-control" style="max-width: 400px;">
                    <option value="">Caricamento riviste...</option>
                </select>
            </div>

            <!-- Blocchi Attuali Section -->
            <div class="section" style="margin-bottom: 32px;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                    <div>
                        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: var(--text-dark); display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 24px;">üß©</span>
                            Blocchi Template
                        </h2>
                        <p style="margin: 4px 0 0 0; color: var(--text-light); font-size: 14px;">
                            Gestisci i template dei blocchi disponibili nel sistema
                        </p>
                    </div>
                    <button class="btn btn-secondary" onclick="refreshBlockTemplates()" style="display: flex; align-items: center; gap: 8px;">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13.65 2.35C12.2 0.9 10.21 0 8 0C3.58 0 0.01 3.58 0.01 8C0.01 12.42 3.58 16 8 16C11.73 16 14.84 13.45 15.73 10H13.65C12.83 12.33 10.61 14 8 14C4.69 14 2 11.31 2 8C2 4.69 4.69 2 8 2C9.66 2 11.14 2.69 12.22 3.78L9 7H16V0L13.65 2.35Z" fill="currentColor"/>
                        </svg>
                        Ricarica
                    </button>
                </div>
                
                <div id="currentBlocksGrid" class="blocks-template-grid">
                    <!-- Blocks will be loaded here -->
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--text-light);">
                        <div style="font-size: 64px; margin-bottom: 16px;">‚è≥</div>
                        <p style="font-size: 16px; font-weight: 500;">Caricamento blocchi...</p>
                    </div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div style="margin-bottom: 24px; border-bottom: 2px solid var(--border-light);">
                <div style="display: flex; gap: 8px;">
                    <button class="tab-btn active" data-tab="blocks">
                        üì¶ Blocchi
                    </button>
                    <button class="tab-btn" data-tab="json">
                        üîß JSON Editor
                    </button>
                    <button class="tab-btn" data-tab="create">
                        ‚ûï Crea Blocco
                    </button>
                </div>
            </div>

            <!-- Tab: Blocchi -->
            <div class="tab-content active" data-tab="blocks">
                <div id="blocksList">
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-light);">
                        <div style="font-size: 64px; margin-bottom: 16px;">üì¶</div>
                        <p>Seleziona una rivista per vedere i blocchi</p>
                    </div>
                </div>
            </div>

            <!-- Tab: JSON Editor -->
            <div class="tab-content" data-tab="json">
                <div style="background: white; padding: 24px; border-radius: 12px; border: 1.5px solid rgba(60, 61, 143, 0.12);">
                    <h3 style="margin-bottom: 16px;">JSON Completo della Rivista</h3>
                    <div class="json-viewer">
                        <pre class="code-editor" id="jsonEditor">{
  "message": "Seleziona una rivista per vedere il JSON"
}</pre>
                    </div>
                    <div style="margin-top: 16px; display: flex; gap: 12px;">
                        <button class="btn btn-secondary" onclick="copyJSON()">
                            üìã Copia JSON
                        </button>
                        <button class="btn btn-primary" onclick="downloadJSON()">
                            üíæ Scarica JSON
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab: Crea Blocco -->
            <div class="tab-content" data-tab="create">
                <div style="background: white; padding: 24px; border-radius: 12px; border: 1.5px solid rgba(60, 61, 143, 0.12);">
                    <h3 style="margin-bottom: 16px;">Crea Nuovo Blocco</h3>
                    <p style="color: var(--text-light); margin-bottom: 24px;">
                        Questa funzionalit√† ti permetter√† di creare blocchi direttamente dal JSON o con un editor visuale avanzato.
                    </p>
                    <div style="text-align: center; padding: 40px; background: var(--bg-light); border-radius: 8px;">
                        <div style="font-size: 48px; margin-bottom: 12px;">üöß</div>
                        <p style="font-weight: 600;">In sviluppo...</p>
                        <p style="font-size: 13px; color: var(--text-light); margin-top: 8px;">
                            Per ora usa l'editor normale nella pagina della rivista
                        </p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/sidebar.js?v=1.0"></script>
    <script>
        // Inizializza sidebar
        document.addEventListener('DOMContentLoaded', () => {
            initSidebar('developer');
        });
        
        let currentMagazine = null;
        let magazines = [];

        // Carica riviste
        async function loadMagazines() {
            try {
                const response = await apiRequest('/admin/magazines');
                magazines = response.magazines || [];
                
                const select = document.getElementById('magazineSelect');
                select.innerHTML = '<option value="">Seleziona una rivista...</option>';
                
                magazines.forEach(mag => {
                    const option = document.createElement('option');
                    option.value = mag._id;
                    option.textContent = `${mag.name} (${mag.blocks?.length || 0} blocchi)`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Errore caricamento riviste:', error);
                alert('Errore nel caricamento delle riviste');
            }
        }

        // Cambia rivista
        document.getElementById('magazineSelect')?.addEventListener('change', async (e) => {
            const magazineId = e.target.value;
            if (!magazineId) {
                currentMagazine = null;
                updateBlocksList();
                updateJSON();
                return;
            }

            try {
                const response = await apiRequest(`/admin/magazines/${magazineId}`);
                currentMagazine = response.magazine;
                updateBlocksList();
                updateJSON();
            } catch (error) {
                console.error('Errore caricamento rivista:', error);
                alert('Errore nel caricamento della rivista');
            }
        });

        // Aggiorna lista blocchi
        function updateBlocksList() {
            const container = document.getElementById('blocksList');
            
            if (!currentMagazine || !currentMagazine.blocks || currentMagazine.blocks.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-light);">
                        <div style="font-size: 64px; margin-bottom: 16px;">üì¶</div>
                        <p>${currentMagazine ? 'Nessun blocco in questa rivista' : 'Seleziona una rivista per vedere i blocchi'}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = currentMagazine.blocks.map((block, index) => `
                <div class="block-preview-card">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <span class="block-type-label">${block.type}</span>
                            <h4 style="margin: 8px 0 4px 0; font-size: 16px;">${block.title || block.tag || 'Blocco ' + (index + 1)}</h4>
                            ${block.subtitle ? `<p style="color: var(--text-light); font-size: 13px; margin: 0;">${block.subtitle}</p>` : ''}
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-sm btn-secondary" onclick="editBlock('${block._id}')">
                                ‚úèÔ∏è Modifica
                            </button>
                            <button class="btn btn-sm" onclick="viewBlockJSON('${block._id}')" style="background: #1e1e1e; color: white;">
                                {} JSON
                            </button>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: var(--text-light);">
                        <strong>ID:</strong> <code style="background: var(--bg-light); padding: 2px 6px; border-radius: 4px; font-family: monospace;">${block._id}</code>
                        <span style="margin: 0 12px;">‚Ä¢</span>
                        <strong>Ordine:</strong> ${block.order}
                        <span style="margin: 0 12px;">‚Ä¢</span>
                        <strong>Visibile:</strong> ${block.visible !== false ? '‚úÖ' : '‚ùå'}
                    </div>
                </div>
            `).join('');
        }

        // Aggiorna JSON
        function updateJSON() {
            const editor = document.getElementById('jsonEditor');
            if (!currentMagazine) {
                editor.textContent = JSON.stringify({message: "Seleziona una rivista"}, null, 2);
                return;
            }
            editor.textContent = JSON.stringify(currentMagazine, null, 2);
        }

        // Modifica blocco (apre la pagina della rivista)
        function editBlock(blockId) {
            window.location.href = `blocks.html?id=${currentMagazine._id}#block-${blockId}`;
        }

        // Visualizza JSON del blocco
        function viewBlockJSON(blockId) {
            const block = currentMagazine.blocks.find(b => b._id === blockId);
            if (!block) return;
            
            const jsonStr = JSON.stringify(block, null, 2);
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>JSON Blocco</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <pre class="code-editor" style="max-height: 500px; overflow-y: auto;">${jsonStr}</pre>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="navigator.clipboard.writeText(\`${jsonStr.replace(/`/g, '\\`')}\`); alert('‚úÖ JSON copiato!')">
                            üìã Copia JSON
                        </button>
                        <button class="btn btn-primary" onclick="this.closest('.modal').remove()">
                            Chiudi
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Copia JSON completo
        function copyJSON() {
            const json = document.getElementById('jsonEditor').textContent;
            navigator.clipboard.writeText(json).then(() => {
                alert('‚úÖ JSON copiato negli appunti!');
            });
        }

        // Scarica JSON
        function downloadJSON() {
            if (!currentMagazine) return;
            
            const json = JSON.stringify(currentMagazine, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentMagazine.name.replace(/\s+/g, '_')}_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ============================================
        // BLOCCHI ATTUALI - GESTIONE TEMPLATE
        // ============================================
        
        let blockTemplates = [];
        
        /**
         * Carica i template dei blocchi dal file index.json
         */
        async function loadBlockTemplates() {
            try {
                const response = await fetch('blocks-templates/index.json');
                if (!response.ok) throw new Error('Impossibile caricare index.json');
                
                const index = await response.json();
                
                // Carica config per ogni blocco
                const promises = index.blocks.map(async (block) => {
                    try {
                        const configResponse = await fetch(`blocks-templates/${block.configPath}`);
                        if (!configResponse.ok) throw new Error(`Config non trovato per ${block.type}`);
                        
                        const config = await configResponse.json();
                        return {
                            ...block,
                            config: config
                        };
                    } catch (error) {
                        console.error(`Errore caricamento config per ${block.type}:`, error);
                        return null;
                    }
                });
                
                const results = await Promise.all(promises);
                blockTemplates = results.filter(b => b !== null);
                
                renderBlockTemplates();
                
            } catch (error) {
                console.error('Errore caricamento blocchi:', error);
                document.getElementById('currentBlocksGrid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #ef4444;">
                        <div style="font-size: 48px; margin-bottom: 12px;">‚ùå</div>
                        <p>Errore nel caricamento dei blocchi</p>
                        <p style="font-size: 13px; color: #64748b; margin-top: 8px;">${error.message}</p>
                    </div>
                `;
            }
        }
        
        /**
         * Renderizza i blocchi nella griglia
         */
        function renderBlockTemplates() {
            const grid = document.getElementById('currentBlocksGrid');
            
            if (blockTemplates.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--text-light);">
                        <div style="font-size: 64px; margin-bottom: 16px;">üì¶</div>
                        <p style="font-size: 16px; font-weight: 500;">Nessun blocco template trovato</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = blockTemplates.map(block => `
                <div class="block-template-card">
                    <div class="block-template-header">
                        <div class="block-template-icon">${block.config.icon || 'üì¶'}</div>
                        <div class="block-template-info">
                            <h3 id="blockName_${block.type}">${block.config.name}</h3>
                            <p>v${block.config.version} ‚Ä¢ ${block.type}</p>
                        </div>
                    </div>
                    
                    <p style="font-size: 13px; color: var(--text-light); margin-bottom: 16px; line-height: 1.6;">
                        ${block.config.description}
                    </p>
                    
                    <div class="block-template-fields">
                        <div class="block-template-fields-title">${block.config.fields.length} Campi</div>
                        <div>
                            ${block.config.fields.slice(0, 4).map(field => `
                                <span class="block-template-field-tag">${field.label}</span>
                            `).join('')}
                            ${block.config.fields.length > 4 ? `<span class="block-template-field-tag">+${block.config.fields.length - 4}</span>` : ''}
                        </div>
                    </div>
                    
                    <div class="block-template-actions">
                        <button class="btn-block-action" onclick="editBlockName('${block.type}')">
                            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11.334 2.00004C11.5091 1.82494 11.7169 1.68605 11.9457 1.59129C12.1745 1.49653 12.4197 1.44775 12.6673 1.44775C12.9149 1.44775 13.1601 1.49653 13.3889 1.59129C13.6177 1.68605 13.8256 1.82494 14.0007 2.00004C14.1757 2.17513 14.3146 2.383 14.4094 2.61178C14.5042 2.84055 14.5529 3.08575 14.5529 3.33337C14.5529 3.58099 14.5042 3.82619 14.4094 4.05497C14.3146 4.28374 14.1757 4.49161 14.0007 4.66671L5.00065 13.6667L1.33398 14.6667L2.33398 11L11.334 2.00004Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Rinomina
                        </button>
                        <button class="btn-block-action secondary" onclick="viewBlockFiles('${block.type}')">
                            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14 2H8.66667L6.66667 0H2C0.89543 0 0 0.89543 0 2V14C0 15.1046 0.89543 16 2 16H14C15.1046 16 16 15.1046 16 14V4C16 2.89543 15.1046 2 14 2Z" fill="currentColor"/>
                            </svg>
                            File
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        /**
         * Modifica il nome di un blocco
         */
        async function editBlockName(blockType) {
            const block = blockTemplates.find(b => b.type === blockType);
            if (!block) return;
            
            const newName = prompt(`Nuovo nome per il blocco "${block.config.name}":`, block.config.name);
            if (!newName || newName === block.config.name) return;
            
            try {
                // Aggiorna config locale
                block.config.name = newName;
                
                // Salva su backend
                const response = await fetch(`/api/admin/block-templates/${blockType}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ name: newName })
                });
                
                if (!response.ok) throw new Error('Errore salvataggio');
                
                // Aggiorna UI
                document.getElementById(`blockName_${blockType}`).textContent = newName;
                
                alert(`‚úÖ Nome blocco aggiornato con successo!`);
                
            } catch (error) {
                console.error('Errore aggiornamento nome:', error);
                alert(`‚ùå Errore: ${error.message}`);
                // Ripristina nome precedente
                loadBlockTemplates();
            }
        }
        
        /**
         * Visualizza i file di un blocco
         */
        function viewBlockFiles(blockType) {
            const block = blockTemplates.find(b => b.type === blockType);
            if (!block) return;
            
            const files = [
                { name: 'config.json', path: block.configPath, type: 'json' },
                { name: 'template.html', path: block.templatePath, type: 'html' },
                { name: 'styles.css', path: block.stylesPath, type: 'css' },
                { name: 'script.js', path: block.scriptPath, type: 'javascript' }
            ];
            
            const filesList = files.map(f => `‚Ä¢ ${f.name} (${f.path})`).join('\n');
            
            alert(`üìÅ File del blocco "${block.config.name}":\n\n${filesList}\n\nüí° In futuro potrai modificare questi file direttamente dall'interfaccia!`);
        }
        
        /**
         * Ricarica i template dei blocchi
         */
        function refreshBlockTemplates() {
            document.getElementById('currentBlocksGrid').innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #64748b;">
                    <div style="font-size: 48px; margin-bottom: 12px;">‚è≥</div>
                    <p>Ricaricamento blocchi...</p>
                </div>
            `;
            loadBlockTemplates();
        }

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                
                // Update buttons
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Update content
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelector(`.tab-content[data-tab="${tab}"]`).classList.add('active');
            });
        });

        // Init
        loadMagazines();
        loadBlockTemplates(); // Carica i blocchi all'avvio
        
        // Welcome message
        const user = getCurrentUser();
        if (user && user.name) {
            document.getElementById('welcomeMessage').textContent = `Ciao ${user.name}`;
        }
        
        // Show permissions link only for super-admin
        if (isSuperAdmin()) {
            document.getElementById('permissionsNavItem').style.display = 'block';
        }
        
        // Users nav
        document.getElementById('usersNavItem').addEventListener('click', handleUsersAccess);
        
        // ADV nav
        const advNavItem = document.getElementById('advNavItem');
        if (advNavItem) {
            advNavItem.addEventListener('click', (e) => {
                e.preventDefault();
                alert('üì¢ Gestione ADV in arrivo!\n\nQui potrai configurare banner pubblicitari e sponsorizzazioni.');
            });
        }
    </script>

    <style>
        .tab-btn {
            background: none;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab-btn:hover {
            color: var(--primary);
            background: rgba(60, 61, 143, 0.05);
        }
        
        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</body>
</html>
